(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],[,,,,,,function(e,t,n){e.exports=n.p+"static/media/menu.c159867d.svg"},,function(e,t,n){e.exports=n(19)},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),i=n(5),r=n.n(i),l=(n(13),n(1));n(14),n(15);function o(e,t,n,a){for(var s=void 0,i=void 0,r=void 0,l=void 0,o=void 0,c=0,d=0,m=0;m<t.length;m++)"{"===t[m]?c=m:"}"===t[m]&&(d=++m);if(c&&!d)return{failure:!0,msg:"entered JSON string '"+t.slice(c,t.length-1)+"' was missing a closing bracket"};if(c){try{s=JSON.parse(t.slice(c,d))}catch(E){return{failure:!0,msg:"entered JSON string '"+t.slice(c,d)+"' was invalid. Did you remember to put quotes?"}}var u=t.substring(0,c),p=void 0;d+1<t.length&&(p=t.substring(d+1,t.length)),t=void 0!==p?u+" "+p:u}var f=t.split(" "),g=[];f.forEach((function(e){0!==e.length&&g.push(e)}));var h=0;if("node"!==(f=g)[h]&&"n"!==f[h]||h++,isNaN(f[h]))return{failure:!0,msg:"Node id '"+f[h]+"' is invalid"};if(i=parseInt(f[h]),"read"===f[++h]||"r"===f[h]){if(r="read","item"!==f[++h]&&"i"!==f[h]||h++,isNaN(f[h]))return{failure:!0,msg:"Item id must be a number, input was '"+f[h]+"'"};l=parseInt(f[h]),h++}else if("update"===f[h]||"u"===f[h]||"write"===f[h]||"w"===f[h]){if(r="update","item"!==f[++h]&&"i"!==f[h]||h++,isNaN(f[h]))return{failure:!0,msg:"Item id must be a number, input was '"+f[h]+"'"};l=parseInt(f[h]),h++}else if("insert"===f[h]||"i"===f[h])r="insert","item"!==f[++h]&&"i"!==f[h]||h++;else{if("delete"!==f[h]&&"d"!==f[h])return{failure:!0,msg:"operation '"+f[h]+"' not recognized"};if(r="delete","item"!==f[++h]&&"i"!==f[h]||h++,isNaN(f[h]))return{failure:!0,msg:"Item id must be a number, input was '"+f[h]+"'"};l=parseInt(f[h]),h++}if(h<f.length&&("delay"===f[h]||"d"===f[h])){if(h++,isNaN(f[h]))return{failure:!0,msg:"delay must be followed by a number, "+f[h]+" is not a number"};o=parseInt(f[h]),h++}if(!n)return{failure:!1};if(n&&!a)return{failure:!0,msg:"A network to perform the operations on must be provided"};var y=a.getNode(i),v=100*o;return"read"===r?y.read(l,v,e):"delete"===r?y.delete(l,v,e):"insert"===r?y.insert(s,v,e):"update"===r?y.update(l,s,v,e):void 0}function c(e){for(var t="[{",n=0;n<e.dataRange.length;n++)t=t.concat(e.dataRange[n].start+" => "+e.dataRange[n].end),n+1<e.dataRange.length&&(t=t.concat("}, {"));t=t.concat("}]");for(var a="<span style=''>[</span></br>",s=e.dataSlice.entries(),i=s.next().value;i;)a=a.concat("<span style='color: #f0d976'>{</span>itemId: "+i[0]+", "),Object.keys(i[1]).forEach((function(e){a=a.concat(e+": "+i[1][e]+", ")})),a=a.slice(0,-2),a=(i=s.next().value)?a.concat("<span style='color: #f0d976'>}</span>,</br>"):a.concat("<span style='color: #f0d976'>}</span></br>");a=a.concat("<span style=''>]</span>");var r=JSON.stringify(e.clock);return r=(r=r.split("[")[1]).split("]")[0],r="<span style='color: #18cdfa'>[</span>".concat(r).concat("<span style='color: #18cdfa'>]</span>"),"<h3 class='nodeinfo-h3'>node "+e.id+" info</h3><span style='color: #f1ef43'>clock: </span>"+r+"</br><span style='color: #f1ef43'>connections: </span>"+JSON.stringify(e.connections)+"</br><span style='color: #f1ef43'>dataRange: </span>"+t+"</br><span style='color: #f1ef43'>dataSlice: </span>"+a}var d=function(e){var t=Object(a.useState)(void 0),n=Object(l.a)(t,2),i=n[0],r=n[1];Object(a.useEffect)((function(){e.rerenderSim&&(o(),d(e.net.numNodes),m(e.net.numNodes))}),[e.rerenderSim]),Object(a.useEffect)((function(){o()}),[]),Object(a.useEffect)((function(){e.net&&(d(e.net.numNodes),m(e.net.numNodes))}),[e.net]),Object(a.useEffect)((function(){e.apiResponse&&void 0===i&&(console.log("received api response! ",e.apiResponse),e.setFinishedExecuting(!1),r(0))}),[e.apiResponse]),Object(a.useEffect)((function(){if(void 0!==i)if(i!==e.sentInstructions.length){e.sentInstructions[i].forEach((function(t){for(var n=t.instrId,a=0;a<e.apiResponse.length;a++)if(e.apiResponse[a].instrId===n){u(e.apiResponse,a,"wait"===document.getElementById("run").innerHTML);break}})),"wait"===document.getElementById("run").innerHTML&&(document.getElementById("run").innerHTML="pause")}else{console.log("executed all blocks!"),e.setFinishedExecuting(!0),r(void 0);for(var t=0;t<e.network.numNodes;t++)e.mostRecentNodeInfo.set(t,c(e.network.getNode(t)))}}),[i]);var o=function(){var e=document.getElementById("sim-wrapper").offsetWidth,t=document.getElementById("sim-wrapper").offsetHeight;if(t>e){var n=document.getElementById("circle-wrapper").offsetWidth;document.documentElement.style.setProperty("--circle-wrapper-height",n+"px"),document.documentElement.style.setProperty("--sim-wrapper-vertical-padding",(document.getElementById("sim-wrapper").offsetHeight-n)/2+"px"),document.getElementById("sim-wrapper").style.height=t+"px"}else t<e&&document.documentElement.style.setProperty("--circle-wrapper-width",document.getElementById("circle-wrapper").offsetHeight+"px")},d=function(t){var n=document.getElementById("circle-wrapper").offsetWidth/7;document.documentElement.style.setProperty("--node-diameter",n+"px");for(var a=function(n){var a=document.createElement("div");a.setAttribute("class","dot"),a.setAttribute("id",n.toString());var s=document.createTextNode(n.toString());a.appendChild(s);var r=360/t*n;i=document.getElementById("circle-wrapper").offsetWidth/2+"px",document.getElementById(n.toString())&&document.getElementById(n.toString()).remove(),document.getElementById("circle-wrapper").append(a),document.getElementById(n.toString()).style.transform="rotate(-90deg) rotate("+r+"deg) translate("+i+") rotate(-"+r+"deg) rotate(90deg)",document.getElementById(n.toString()).style.lineHeight=document.getElementById(n.toString()).offsetWidth-2+"px",document.getElementById(n.toString()).addEventListener("click",(function(t){e.getNodeInfo(n)}))},s=0;s<t;s++){var i;a(s)}var r=[];e.net.nodeMap.forEach((function(e){e.connections.forEach((function(t){if(r.findIndex((function(n){return n[0]===e.id&&n[1]===t||n[1]===e.id&&n[0]===t}))<0){var n=function(e,t){var n=p(e),a=p(t),s=n.left+n.width/2,i=n.top+n.height/2,r=a.left+a.width/2,l=a.top+a.height/2,o=Math.sqrt((r-s)*(r-s)+(l-i)*(l-i)),c=(s+r)/2-o/2,d=(i+l)/2-1,m=Math.atan2(i-l,s-r)*(180/Math.PI),u=document.createElement("div");return u.style.padding="0px",u.style.margin="0px",u.style.height="2px",u.style.backgroundColor="#282c34",u.style.lineHeight="1px",u.style.position="absolute",u.style.left=c+"px",u.style.top=d+"px",u.style.width=o+"px",u.style.transform="rotate("+m+"deg)",u}(document.getElementById(e.id.toString()),document.getElementById(t.toString()));document.getElementById("sim-wrapper").insertBefore(n,document.getElementById("circle-wrapper"))}}))}))},m=function(e){document.getElementById("0").getBoundingClientRect().top,parseInt(getComputedStyle(document.getElementById("0")).width),document.getElementById("sim-wrapper").offsetWidth,document.getElementById("sim-wrapper").offsetHeight;for(var t=0;t<e;t++)for(var n=0;n<e;n++)if(t!==n){var a,s,i,r;a=document.getElementById(t.toString()).getBoundingClientRect().left+window.pageXOffset,i=document.getElementById(t.toString()).getBoundingClientRect().top+window.pageYOffset,s=document.getElementById(n.toString()).getBoundingClientRect().left+window.pageXOffset,r=document.getElementById(n.toString()).getBoundingClientRect().top+window.pageYOffset,document.styleSheets[0].insertRule("@keyframes id".concat(t,"to").concat(n," { from{ left:").concat(a,"px; top:").concat(i,"px   } to{ left:").concat(s,"px; top:").concat(r,"px } }")),document.styleSheets[0].insertRule(".msg".concat(t,"to").concat(n," { left:").concat(a,"px; top:").concat(i,"px }"))}},u=function t(n,a,s){console.log("executing "+a);for(var l=a-1;l>=0;--l)if(!1===n[l].done)return console.log("out of order, waiting for correct thing to execute"),void setTimeout((function(){return t(n,a)}),500);if(a!==n.length){var o=n[a];if("recv"===o.dir&&o.msg.includes("original")){console.log("finished instr "+o.instrId),o.done=!0,e.setApiResponse(JSON.parse(JSON.stringify(n)));var c=e.sentInstructions,d=c[i],m=d.findIndex((function(e){return e.instrId===o.instrId}));m>=0&&(d[m].done=!0);for(var u=!0,p=0;p<d.length;p++)d[p].done||(u=!1);return e.setSentInstructions(JSON.parse(JSON.stringify(c))),void(u&&r(i+1))}if("recv"===o.dir&&o.msg.includes("final")&&o.msg.includes("updateDataRange"))return console.log("finished instr "+o.instrId),o.done=!0,void e.setApiResponse(JSON.parse(JSON.stringify(n)));for(var f=a+1;n[f].instrId!==n[a].instrId;)f++;var g=n[f];if(g.nodeId===o.nodeId)return o.done=!0,e.setApiResponse(JSON.parse(JSON.stringify(n))),void t(n,f);if(o.msg.includes("initial payload")||"send"===o.dir&&o.msg.includes("middle")||"send"===o.dir&&o.msg.includes("final")){var h=1+g.networkLatency/100+g.additionalDelay/100,y=document.createElement("div"),v="instr_".concat(o.instrId,"_msg").concat(o.nodeId,"to").concat(g.nodeId,"_apiresindex_").concat(a);y.setAttribute("class","msg msg".concat(o.nodeId,"to").concat(g.nodeId)),y.setAttribute("id",v),document.getElementById("sim-wrapper").appendChild(y);var E=document.getElementById(v);return E.style.height=document.getElementById("0").offsetHeight+"px",E.style.width=document.getElementById("0").offsetWidth+"px",E.style.lineHeight=E.offsetHeight.toString()+"px",E.style.animation=s?"id".concat(o.nodeId,"to").concat(g.nodeId," ").concat(h,"s linear forwards paused"):"id".concat(o.nodeId,"to").concat(g.nodeId," ").concat(h,"s linear forwards"),E.addEventListener("animationend",(function(){console.log("Animation ".concat(v," ended")),E.remove(),t(n,f)})),E.addEventListener("click",(function(){return e.getPayloadInfo(a,v)})),o.done=!0,void e.setApiResponse(JSON.parse(JSON.stringify(n)))}return"recv"===o.dir&&o.msg.includes("middle")||"recv"===o.dir&&o.msg.includes("final")?(o.done=!0,e.setApiResponse(JSON.parse(JSON.stringify(n))),t(n,f)):void 0}console.log("does this ever happen?")};function p(e){var t=e.getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:t.width||e.offsetWidth,height:t.height||e.offsetHeight}}return s.a.createElement("div",{id:"sim-wrapper",className:"sim-wrapper"},s.a.createElement("div",{id:"circle-wrapper",className:"circle-wrapper"}))},m=(n(16),n(17),function(e){Object(a.useEffect)((function(){if(e.finishedExecuting&&e.finishedExecuting){var n=document.getElementById("run");n.innerHTML="reset",n.addEventListener("click",t)}}),[e.finishedExecuting]);var t=function t(){var n=document.getElementById("run");n.classList.remove("run-active"),n.classList.remove("run-running"),n.classList.remove("display-block"),n.classList.remove("display-none"),n.innerHTML="run",document.getElementById("textarea").value="",e.setFinishedExecuting(void 0),e.setRunButtonClasses(["run"]);document.getElementById("prompt").classList.toggle("display-none"),document.getElementById("textarea").classList.toggle("display-none"),document.getElementById("liveinfo").classList.toggle("display-none"),e.setInstrList([]),e.setApiResponseCopy([]),e.setMostRecentStepCompleted([]),n.removeEventListener("click",t)},n=function(t){var n=document.getElementById("run"),a=n.classList.contains("run-active"),s=n.classList.contains("run-running"),i=document.getElementById("play");if("run"===t&&a&&!s){document.getElementById("err-text")&&document.getElementById("err-text").remove();var r=!0,l=function(e){for(var t,n=(e=e.toLowerCase()).split("\n"),a=0,s=0,i=!0,r=!1,l=0;l<n.length;++l){var o=n[l].trim();o.length&&("normal"!==o?"in-order"!==o?t?i&&!t[s]?(t.push([{instrId:a++,text:o,done:!1}]),s=t.length-1):i&&t[s]?t[s].push({instrId:a++,text:o,done:!1}):r&&(t.push([{instrId:a++,text:o,done:!1}]),s=t.length):t=[[{instrId:a++,text:o,done:!1}]]:(i=!1,r=!0):(i=!0,r=!1,t&&(s=t.length)))}return t}(document.getElementById("textarea").value);l.forEach((function(e){e.forEach((function(e){var t=o(e.instrId,e.text,!1);if(t.failure){r=!1;var n=document.createElement("span");n.setAttribute("id","err-text"),n.setAttribute("style","color: orange");var a=document.createTextNode("failure: "+t.msg);n.appendChild(a),document.getElementById("console").insertBefore(n,document.getElementById("textarea"))}}))})),r&&(e.setInstructionsToSend(l),n.innerHTML="wait",n.classList.add("run-running"),document.getElementById("run").click())}else if("run"===t&&s){for(var c=document.getElementsByClassName("msg"),d=0;d<c.length;d++){document.getElementById(c.item(d).getAttribute("id")).style.animationPlayState="paused"}n.classList.remove("run-active"),n.classList.remove("run-running"),n.classList.add("display-none"),i.classList.remove("display-none")}else if("play"===t){for(var m=document.getElementsByClassName("msg"),u=0;u<m.length;u++){document.getElementById(m.item(u).getAttribute("id")).style.animationPlayState="running"}n.classList.remove("display-none"),n.classList.add("run-active"),n.classList.add("run-running"),i.classList.add("display-none")}};return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{id:"run",className:"run",onClick:function(){document.getElementById("run").classList.length>1&&n("run")}},"run"),s.a.createElement("div",{id:"play",className:"play display-none",onClick:function(){n("play")}},"play"),s.a.createElement("div",{id:"tutorial",className:"tutorial",onClick:function(){return document.getElementById("tutorial").classList.add("display-none"),document.getElementById("menu-btn").click(),void setTimeout((function(){document.getElementById("tutorial-li").click()}),800)}},"first visit?"))}),u=function(e){var t=Object(a.useState)([]),n=Object(l.a)(t,2),i=n[0],r=n[1],o=Object(a.useState)([]),c=Object(l.a)(o,2),d=c[0],u=c[1],p=Object(a.useState)(new Map),f=Object(l.a)(p,2),g=f[0],h=f[1],y=Object(a.useState)([]),v=Object(l.a)(y,2),E=v[0],I=v[1];Object(a.useEffect)((function(){if(e.apiResponse){0===d.length&&x(),u(e.apiResponse),console.log("console received new api progression"),console.log(e.apiResponse);for(var t=document.getElementsByClassName("msg"),n=0;n<t.length;n++){var a=t.item(n),s=a.id.split("_");!a.innerHTML&&g.get(parseInt(s[1]))&&(a.innerHTML=g.get(parseInt(s[1])))}}}),[e.apiResponse]),Object(a.useEffect)((function(){void 0!==e.ControlsProps.finishedExecuting&&!1===e.ControlsProps.finishedExecuting&&(w(),b())}),[e.ControlsProps.finishedExecuting]),Object(a.useEffect)((function(){e.sentInstructions&&(console.log("updated instr:"),console.log(e.sentInstructions),b())}),[e.sentInstructions]),Object(a.useEffect)((function(){0===i.length?(h(void 0),I([])):0===E.length&&i.forEach((function(e){return E[e.instrId]=!1}))}),[i]);var w=function(){document.getElementById("prompt").classList.toggle("display-none"),document.getElementById("textarea").classList.toggle("display-none"),document.getElementById("liveinfo").classList.toggle("display-none")},b=function(){var t=[];e.sentInstructions.forEach((function(e){e.forEach((function(e){t.push(e)}))})),r(t)},k=function(e,t){var n=void 0,a=void 0;if(g?n=g.get(e.instrId):a=new Map,void 0===n){for(var s,r=[],l=0;l<i.length;l++){for(var o=i[l],c=o.text.split(" "),d=0,m=!1;!m;)"read"===c[d]||"r"===c[d]?(s="r",m=!0):"update"===c[d]||"u"===c[d]?(s="u",m=!0):"insert"===c[d]||"i"===c[d]?(s="i",m=!0):"delete"!==c[d]&&"d"!==c[d]||(s="d",m=!0),d++;if("item"!==c[d]&&"i"!==c[d]||d++,"i"!==s){s=s.concat(c[d]);for(var u=r.length-1;u>=0;u--){var p=r[u].label;p[0]===s[0]&&p[1]===s[1]&&(s=p.includes("_")?s.concat("_"+(parseInt(p[p.length-1])+1).toString()):s.concat("_2"))}}else for(var f=r.length-1;f>=0;f--){var y=r[f].label;y[0]===s[0]&&(s=y.includes("_")?s.concat("_"+(parseInt(y[y.length-1])+1).toString()):s.concat("_2"))}r.push({instrId:o.instrId,label:s})}return r.forEach((function(e){a.set(e.instrId,e.label)})),"run"!==document.getElementById("run").innerHTML&&h(a),s=a.get(e.instrId),!1===t?s:s+": "}return!1===t?n:n+": "},N=function(e){return e.done?"gray":e.msg.includes("final")?"blue":e.msg.includes("original")?"yellow":"sky"},x=function(){for(var e=document.getElementById("instrlist").offsetWidth,t=document.getElementsByClassName("listlabel"),n=0,a=0;a<t.length;a++){var s=t.item(a).offsetWidth;s>n&&(n=s)}var i=document.getElementsByClassName("listmsg");t=document.getElementsByClassName("listlabel");for(var r=0;r<i.length;r++){var l=i.item(r),o=t.item(r);l.style.width=e-n-1+"px",o.style.lineHeight=l.offsetHeight+"px"}},S=function(e,t){var n=e[t].done?"gray":"sky";return 0===t&&(n=n.concat(" first")),t===e.length-1&&(n=n.concat(" last")),n};return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{id:"console",className:"console"},s.a.createElement(m,Object.assign({},e.ControlsProps,{setInstrList:r,setApiResponseCopy:u})),s.a.createElement("div",{id:"prompt",className:"before-textarea blink"},">>>"),s.a.createElement("textarea",{id:"textarea",onClick:function(){return document.getElementById("prompt").classList.remove("blink")},onChange:e.handleTextAreaInput}),s.a.createElement("div",{id:"liveinfo",className:"liveinfo display-none"},s.a.createElement("h3",{className:"liveinfo-h3 top-margin-20"},"executing instructions:"),s.a.createElement("ul",{className:"instrlist"},i.map((function(e,t){return s.a.createElement("li",{id:"instr"+e.instrId.toString(),key:t,className:S(i,t)},e.done?s.a.createElement("s",null,"instr "+k(e)):"instr "+k(e),e.text,e.done&&!E[e.instrId]?s.a.createElement("div",{className:"view-response",onClick:function(){return function(e){var t=[];E.forEach((function(n,a){t[a]=a===e||n})),I(t)}(e.instrId)}},"view response"):"",E[e.instrId]?s.a.createElement("div",{className:"response-text"},s.a.createElement("span",{className:"blue"}," instr ",k(e,!1)," response: "),s.a.createElement("br",null),function(e){var t=e.res.itemId?"itemId: ".concat(e.res.itemId,", "):"";return e.res.item&&(Object.keys(e.res.item).forEach((function(n){t=t.concat(n+": "+e.res.item[n]+", ")})),t=t.slice(0,-2)),s.a.createElement(s.a.Fragment,null,s.a.createElement("span",{style:{color:"#f1ef43"}},"msg: "),s.a.createElement("span",{dangerouslySetInnerHTML:{__html:e.res.msg}}),s.a.createElement("br",null),s.a.createElement("span",{style:{color:"#f1ef43"}},"item: "),s.a.createElement("span",{style:{color:"#f0d976"}},"{"),t,s.a.createElement("span",{style:{color:"#f0d976"}},"}"))}(e)):"")}))),s.a.createElement("h3",{className:"liveinfo-h3 top-margin"},"all system actions:"),s.a.createElement("ul",{className:"instrlist",id:"instrlist"},d.map((function(e,t){return s.a.createElement("li",{key:t,className:0===t?"first":t===d.length-1?"last":""},e.done?s.a.createElement("div",{className:"listlabel gray"},s.a.createElement("s",null,k(e))):s.a.createElement("div",{className:"listlabel sky"},k(e)),s.a.createElement("div",{className:"listmsg "+N(e)},e.msg))}))))),s.a.createElement("div",{id:"end"}))},p=n(2),f=n(3),g=function e(){Object(p.a)(this,e),this.nodeId=void 0,this.start=void 0,this.end=void 0,this.full=void 0,this.highestItemId=void 0},h=function(){function e(){Object(p.a)(this,e),this.map=new Map,this.keysInOrder=[]}return Object(f.a)(e,[{key:"set",value:function(e,t){this.map.has(e)||(this.keysInOrder.push(e),this.keysInOrder.sort((function(e,t){return e-t}))),this.map.set(e,t)}},{key:"get",value:function(e){return this.map.get(e)}},{key:"delete",value:function(e){for(var t=void 0,n=0;n<this.keysInOrder.length;n++)if(this.keysInOrder[n]===e){t=n;break}return void 0!==t&&this.keysInOrder.splice(t,1),this.map.delete(e)}}]),e}(),y=function(){function e(t,n){var a=this;Object(p.a)(this,e),this.id=0,this.connections=[],this.latency=100,this.nodeMap=new Map,this.dataRangeOrderedMap=new h,this.dataRange=[],this.dataSlice=new Map,this.clock=[],this.mostRecentWrite=void 0,this.eventStream=void 0,this.processPayload=function(e,t,n){if(e.hasOwnProperty("msg")&&"Hello!"===e.msg)return Promise.resolve("Hello from node "+a.id);if(e.pathIndex!==e.path.length-1&&0!==e.pathIndex)return"updateDataRange"!==e.op&&a.eventStream.next({instrId:e.instrId,nodeId:a.id,dir:"recv",networkLatency:t,additionalDelay:n,msg:"middle node "+a.id+" received payload",payload:JSON.parse(JSON.stringify(e)),done:!1,nodeInfoString:c(a)}),"out"===e.dir?++e.pathIndex:--e.pathIndex,e.id=e.path[e.pathIndex],"updateDataRange"!==e.op&&a.eventStream.next({instrId:e.instrId,nodeId:a.id,dir:"send",msg:"middle node "+a.id+" changed payload path, is forwarding",payload:JSON.parse(JSON.stringify(e)),done:!1,nodeInfoString:c(a)}),a.ping(e);if("r"===e.op&&e.pathIndex===e.path.length-1&&"out"===e.dir){a.syncAndIncrementClock(e.sourceClock),a.eventStream.next({instrId:e.instrId,nodeId:a.id,dir:"recv",networkLatency:t,additionalDelay:n,msg:"final node "+a.id+" received payload",payload:JSON.parse(JSON.stringify(e)),done:!1,nodeInfoString:c(a)}),a.clock[a.id]++,e.requestClock=e.sourceClock,e.sourceClock=JSON.parse(JSON.stringify(a.clock));for(var s="itemId "+e.itemId+" was not found in database",i=0;i<a.dataRange.length;i++)if(e.itemId>=a.dataRange[i].start&&e.itemId<=a.dataRange[i].end){s="successful";break}var r=a.dataSlice.get(e.itemId);return r=JSON.parse(JSON.stringify(r)),e.msg=s,e.item=r,e.dir="in",e.id=e.path[--e.pathIndex],a.eventStream.next({instrId:e.instrId,nodeId:a.id,dir:"send",msg:"final node "+a.id+" sending read response",payload:JSON.parse(JSON.stringify(e)),done:!1,nodeInfoString:c(a)}),a.ping(e)}if("u"===e.op&&e.pathIndex===e.path.length-1&&"out"===e.dir){a.syncAndIncrementClock(e.sourceClock),a.eventStream.next({instrId:e.instrId,nodeId:a.id,dir:"recv",networkLatency:t,additionalDelay:n,msg:"final node "+a.id+" received payload",payload:JSON.parse(JSON.stringify(e)),done:!1,nodeInfoString:c(a)});for(var l="itemId "+e.itemId+" was not found in database",o=0;o<a.dataRange.length;o++)if(e.itemId>=a.dataRange[o].start&&e.itemId<=a.dataRange[o].end){l="successful";break}var d=a.dataSlice.get(e.itemId),m=a.sourceHasUpdatedVectorClock(e);if(d&&(m||e.item.deleted)){for(var u=e.item,p=0,f=Object.keys(u);p<f.length;p++){var g=f[p];if("deleted"===g&&!0===u[g]){d={deleted:!0};break}d[g]=u[g]}a.dataSlice.set(e.itemId,d)}return!1===m&&!1===!!e.item.deleted&&(l="this write has already been overwritten. Returning what is currently in the database"),m&&(a.mostRecentWrite={clock:JSON.parse(JSON.stringify(e.sourceClock)),itemId:e.itemId,item:e.item}),d=JSON.parse(JSON.stringify(d)),e.msg=l,e.item=d,e.dir="in",e.id=e.path[--e.pathIndex],a.clock[a.id]++,e.requestClock=e.sourceClock,e.sourceClock=JSON.parse(JSON.stringify(a.clock)),a.eventStream.next({instrId:e.instrId,nodeId:a.id,dir:"send",msg:"final node "+a.id+" sending update response",payload:JSON.parse(JSON.stringify(e)),done:!1,nodeInfoString:c(a)}),a.ping(e)}if("i"===e.op&&e.pathIndex===e.path.length-1&&"out"===e.dir){a.syncAndIncrementClock(e.sourceClock),a.eventStream.next({instrId:e.instrId,nodeId:a.id,dir:"recv",networkLatency:t,additionalDelay:n,msg:"final node "+a.id+" received payload",payload:JSON.parse(JSON.stringify(e)),done:!1,nodeInfoString:c(a)});var h="successful",y={},v=void 0;if(e.hasOwnProperty("newRange"))a.dataRange.push(e.newRange),a.dataRangeOrderedMap.set(e.newRange.start,e.newRange),e.itemId=e.newRange.start,a.dataSlice.set(e.itemId,e.item),y=a.dataSlice.get(e.itemId),h="new range "+JSON.stringify(e.newRange,null,"</br>")+" added",v=e.newRange;else{var E=0;a.dataSlice.forEach((function(e,t){t>E&&(E=t)})),e.itemId=E+1,a.dataSlice.set(e.itemId,e.item),y=a.dataSlice.get(e.itemId),a.dataRange.forEach((function(t){e.itemId===t.end&&(t.full=!0,h="range that starts at "+t.start+" is now full",v=t)}))}if(v){var I,w=a.shortestPath(0,!0);w instanceof Map&&(I=w),I.forEach((function(t,n){if(n!==a.id&&n!==e.path[0]){a.clock[a.id]++;var s=JSON.parse(JSON.stringify(a.clock)),i=t.path[0]===a.id?1:0,r={id:t.path[i],path:t.path,pathIndex:i,op:"updateDataRange",newRange:v,dir:"out",sourceClock:s,instrId:n+99};a.ping(r)}}))}return y=JSON.parse(JSON.stringify(y)),e.newRange=v,e.msg=h,e.item=y,e.dir="in",e.id=e.path[--e.pathIndex],a.clock[a.id]++,e.requestClock=e.sourceClock,e.sourceClock=JSON.parse(JSON.stringify(a.clock)),a.eventStream.next({instrId:e.instrId,nodeId:a.id,dir:"send",networkLatency:t,additionalDelay:n,msg:"final node "+a.id+" sending insert response",payload:JSON.parse(JSON.stringify(e)),done:!1,nodeInfoString:c(a)}),a.ping(e)}return"updateDataRange"===e.op&&e.pathIndex===e.path.length-1&&"out"===e.dir?(a.syncAndIncrementClock(e.sourceClock),a.dataRangeOrderedMap.set(e.newRange.start,e.newRange),Promise.resolve({msg:"updateDataRange on node id "+a.id+" done"})):e.pathIndex<=0&&e.newRange?(a.syncAndIncrementClock(e.sourceClock),a.dataRangeOrderedMap.set(e.newRange.start,e.newRange),a.eventStream.next({instrId:e.instrId,nodeId:a.id,dir:"recv",networkLatency:t,additionalDelay:n,msg:"original node "+a.id+" received response",payload:JSON.parse(JSON.stringify(e)),done:!1,nodeInfoString:c(a)}),Promise.resolve(e)):e.pathIndex<=0?(a.syncAndIncrementClock(e.sourceClock),a.eventStream.next({instrId:e.instrId,nodeId:a.id,dir:"recv",networkLatency:t,additionalDelay:n,msg:"original node "+a.id+" received response",payload:JSON.parse(JSON.stringify(e)),done:!1,nodeInfoString:c(a)}),Promise.resolve(e)):Promise.resolve("unknown")},this.id=t,n&&(this.eventStream=n)}return Object(f.a)(e,[{key:"ping",value:function(e,t){if(this.id<0)return Promise.resolve("node: I am an invalid node!");if(1===e.path.length&&e.path[0]===this.id)return e.pathIndex=0,this.processPayload(e,0,0);var n=this.nodeMap.get(e.id);return n?(t||(t=0),this.connections.includes(e.id)?n.respond(e,t):Promise.resolve("node: this node is not connected to id "+e.id)):Promise.resolve("invalid node id requested")}},{key:"respond",value:function(e,t){var n=this;return new Promise((function(e){var a=n.delay();setTimeout((function(){e({networkLatency:a,additionalDelay:t})}),t?a+t:a)})).then((function(t){return n.processPayload(e,t.networkLatency,t.additionalDelay)}))}},{key:"findAllNodes",value:function(e,t){this.connections.forEach((function(n){var a=t.getNode(n);a.id>=0&&!e.nodeMap.has(a.id)&&(e.nodeMap.set(a.id,a),a.dataRange.forEach((function(t){e.dataRangeOrderedMap.set(t.start,t)})),e.clock.push(0),a.findAllNodes(e,t))}))}},{key:"read",value:function(e,t,n){if(this.clock[this.id]++,"number"===typeof e){for(var a=-1,s=this.dataRangeOrderedMap.keysInOrder.length-1;s>=0;s--){var i=this.dataRangeOrderedMap.keysInOrder[s];if(i<=e){a=void 0===this.dataRangeOrderedMap.get(i)?void 0:this.dataRangeOrderedMap.get(i).nodeId;break}}if(void 0===a)return Promise.resolve({msg:"requested id does not exist in db"});var r,l=this.shortestPath(a,!1);l instanceof Map||(r=l);var o=r[0]===this.id?1:0,d={id:r[o],path:r,pathIndex:o,op:"r",itemId:e,dir:"out",sourceClock:JSON.parse(JSON.stringify(this.clock)),instrId:n};return this.eventStream.next({instrId:d.instrId,nodeId:this.id,dir:"send",msg:"node "+this.id+" emitting initial payload for read op",payload:JSON.parse(JSON.stringify(d)),done:!1,nodeInfoString:c(this)}),this.ping(d,t)}return Promise.resolve({result:"unknown"})}},{key:"update",value:function(e,t,n,a){this.clock[this.id]++;var s=t.deleted?"delete":"update";if("number"===typeof e){for(var i=-1,r=this.dataRangeOrderedMap.keysInOrder.length-1;r>=0;r--){var l=this.dataRangeOrderedMap.keysInOrder[r];if(l<=e){i=void 0===this.dataRangeOrderedMap.get(l)?void 0:this.dataRangeOrderedMap.get(l).nodeId;break}}if(void 0===i)return Promise.resolve({msg:"requested id does not exist in db"});var o,d=this.shortestPath(i,!1);d instanceof Map||(o=d);var m=o[0]===this.id?1:0,u={id:o[m],path:o,pathIndex:m,op:"u",itemId:e,item:t,dir:"out",sourceClock:JSON.parse(JSON.stringify(this.clock)),instrId:a};return this.eventStream.next({instrId:u.instrId,nodeId:this.id,dir:"send",msg:"node "+this.id+" emitting initial payload for "+s+" op",payload:JSON.parse(JSON.stringify(u)),done:!1,nodeInfoString:c(this)}),this.ping(u,n)}return Promise.resolve({result:"unknown"})}},{key:"insert",value:function(e,t,n){this.clock[this.id]++;var a,s=-1,i=this.dataRangeOrderedMap.keysInOrder[this.dataRangeOrderedMap.keysInOrder.length-1],r=this.dataRangeOrderedMap.get(i);if(r&&!r.full){s=r.nodeId;var l,o=this.shortestPath(s,!1);o instanceof Map||(l=o);var d=l[0]===this.id?1:0,m={id:l[d],path:l,pathIndex:d,op:"i",item:e,dir:"out",sourceClock:JSON.parse(JSON.stringify(this.clock)),instrId:n};return this.eventStream.next({instrId:m.instrId,nodeId:this.id,dir:"send",msg:"node "+this.id+" emitting initial payload for insert op",payload:JSON.parse(JSON.stringify(m)),done:!1,nodeInfoString:c(this)}),this.ping(m,t)}this.dataRangeOrderedMap.map.forEach((function(e,t){a?a.find((function(t){return t.nodeId===e.nodeId}))?a.find((function(t){return t.nodeId===e.nodeId})).numDataRange++:a.push({numDataRange:1,nodeId:e.nodeId}):a=[{numDataRange:1,nodeId:e.nodeId}]})),a.sort((function(e,t){return e.numDataRange-t.numDataRange}));for(var u=0,p=0;p<a.length&&!(a[p].numDataRange>a[0].numDataRange);p++)u++;var f=a.splice(0,u);f.sort((function(e,t){return e.nodeId-t.nodeId})),s=f[0].nodeId;var h=new g;h.start=r.end+1,h.end=h.start+this.dataRange[0].end-this.dataRange[0].start,h.full=!1,h.nodeId=s;var y,v=this.shortestPath(s,!1);v instanceof Map||(y=v);var E=y[0]===this.id?1:0,I={id:y[E],path:y,pathIndex:E,op:"i",item:e,newRange:h,dir:"out",sourceClock:JSON.parse(JSON.stringify(this.clock)),instrId:n};return this.eventStream.next({instrId:I.instrId,nodeId:this.id,dir:"send",msg:"node "+this.id+" emitting initial payload for insert op",payload:JSON.parse(JSON.stringify(I)),done:!1,nodeInfoString:c(this)}),this.ping(I,t)}},{key:"delete",value:function(e,t,n){return this.update(e,{deleted:!0},t,n)}},{key:"recover",value:function(){}},{key:"retry",value:function(){}},{key:"shortestPath",value:function(t,n){var a=this,s=new Map;this.nodeMap.forEach((function(e){e.id===a.id?s.set(e.id,{distance:0,visited:!0,path:[e.id]}):s.set(e.id,{distance:void 0,visited:!1,path:[]})}));for(var i=[this.id],r=function(){var r=i.splice(0,1)[0],l=s.get(r),o={distance:-1,visited:!1,path:[]};l&&(o=l);var c=a.nodeMap.get(r),d=new e(-1);if(c&&(d=c),d.connections.forEach((function(e){var t=s.get(e);t&&!t.visited&&(t.distance=o.distance+1,t.path=o.path.concat([e]),i.push(e))})),o.visited=!0,!n&&r===t)return"break"};i.length>0;){if("break"===r())break}if(n)return s;var l=s.get(t),o=[];return l&&(o=l.path),o}},{key:"delay",value:function(){return Math.round(Math.random()*this.latency)}},{key:"syncAndIncrementClock",value:function(e){var t=this;e.forEach((function(e,n){e>t.clock[n]&&(t.clock[n]=e)})),this.clock[this.id]++}},{key:"sourceHasUpdatedVectorClock",value:function(e){var t=!1;if(void 0===this.mostRecentWrite)return!0;for(var n=0;n<this.mostRecentWrite.clock.length;n++)if(this.mostRecentWrite.clock[n]<e.sourceClock[n]){t=!0;break}return t}},{key:"emitEvent",value:function(e){this.eventStream&&this.eventStream.next(e)}}]),e}(),v=n(20),E=function(){function e(t,n,a){var s=this;Object(p.a)(this,e),this.nodeMap=new Map,this.numNodes=void 0,this.eventStream=void 0;var i=n||5;this.eventStream=a||new v.a,this.numNodes=t;for(var r=function(e){var t=new y(e,s.eventStream);if(e>0){var n=[];n.push(Math.round(Math.random()*(s.nodeMap.size-1))),n.forEach((function(e){t.connections.push(e);var n=s.nodeMap.get(e);n.connections.indexOf(t.id)<0&&n.connections.push(t.id)}))}var a=e*i,r=new g;r.nodeId=t.id,r.start=a,r.end=a+i-1,r.full=!0,t.dataRange.push(r);for(var l=0;l<i;l++)t.dataSlice.set(a+l,{fruit:s.getRandomFruit(a+l)});s.nodeMap.set(t.id,t)},l=0;l<t;l++)r(l);this.nodeMap.forEach((function(e){e.findAllNodes(e,s)}))}return Object(f.a)(e,[{key:"getNode",value:function(e){var t=this.nodeMap.get(e);return t||new y(-1)}},{key:"getRandomNode",value:function(){var e=this.nodeMap.get(Math.round(Math.random()*(this.nodeMap.size-1)));return void 0===e&&console.log("network: getRandomNode failed"),e||new y(-1)}},{key:"getRandomFruit",value:function(e){var t=Math.random();return t<.1?"apple":t<.2?"banana":t<.3?"cherry":t<.4?"strawberry":t<.5?"pineapple":t<.6?"tomato":t<.7?"tomahhto":t<.8?"passionfruit":t<.9?"grapefruit":t<.95?"dragonfruit":"a super expensive Japanese melon"}}]),e}(),I=function(e){var t=Object(a.useState)(new v.a),n=Object(l.a)(t,1)[0],i=Object(a.useState)([]),r=Object(l.a)(i,2),c=r[0],d=r[1],m=Object(a.useState)(!1),u=Object(l.a)(m,2),p=u[0],f=u[1];Object(a.useEffect)((function(){e.setNetwork(g(10))}),[]);var g=function(e){return new E(e,3,n)};Object(a.useEffect)((function(){if(e.sentInstructions&&!1!==e.simFinishedExecuting){var t=n.subscribe((function(e){c.push(e)}));h(e.sentInstructions,0,t)}}),[e.sentInstructions]),Object(a.useEffect)((function(){p&&(e.setApiResponse(JSON.parse(JSON.stringify(c))),d([]),f(!1))}),[p]);var h=function t(n,a,s){if(a===n.length)return console.log("completed all commands!"),console.log(e.sentInstructions),s.unsubscribe(),f(!0),{done:!0};for(var i=n[a],r=i.length,l=0,c=function(c){var d=i[c],m=o(d.instrId,d.text,!0,e.network);m instanceof Promise&&m.then((function(e){if(l++,d.res=e,l===r)return t(n,++a,s)}))},d=0;d<i.length;d++)c(d)};return s.a.createElement(s.a.Fragment,null)},w=(n(18),n(6)),b=n.n(w),k=function(e){var t=Object(a.useState)(["menu","overlay"]),n=Object(l.a)(t,2),i=n[0],r=n[1],o=Object(a.useState)("initial-contents"),c=Object(l.a)(o,2),d=c[0],m=c[1],u=s.a.createElement("ul",{id:"initial-contents",className:"initial-contents"},s.a.createElement("li",{id:"tutorial-li",onClick:function(){m("tutorial-contents"),r(["menu menu-full","overlay overlay-active"]),document.getElementById("tutorial").classList.length<2&&document.getElementById("tutorial").classList.add("display-none")}},s.a.createElement("h2",null,"welcome")),s.a.createElement("li",{onClick:function(){m("example-contents"),r(["menu menu-full","overlay overlay-active"])}},s.a.createElement("h2",null,"example commands")),s.a.createElement("li",{onClick:function(){m("about-contents"),r(["menu menu-full","overlay overlay-active"])}},s.a.createElement("h2",null,"motivation"))),p=function(e){return s.a.createElement("div",{id:e.id,className:e.classes?"msg-showcase "+e.classes:"msg-showcase",style:{backgroundColor:e.bgc,animation:e.animation}},e.label)},f=s.a.createElement("span",{className:"back-to-menu",onClick:function(){m("initial-contents"),r(["menu menu-active","overlay overlay-active"]),document.getElementById("root").style.removeProperty("height"),document.getElementById("app").style.removeProperty("height")}},"back to menu"),g=s.a.createElement(s.a.Fragment,null,f,s.a.createElement("div",{id:"tutorial-wrapper",className:"menu-content-wrapper"},s.a.createElement("h1",{id:"tutorial-contents-hero",className:"contents-hero tutorial-first-fade"},"Welcome."),s.a.createElement("p",{id:"tutorial-second-fade",className:"tutorial-second-fade"},"You might have heard about Lamport clocks, but what the heck are they actually used for? Keep reading to find out."),window.innerWidth>1195?s.a.createElement("p",{className:"tutorial-second-fade"},"*This app was designed on mobile first. Feel free to visit on your phone as well - this page is especially suited for vertical scrolling :)"):"",s.a.createElement("ul",{id:"tutorial-third-fade",className:"instrlist menulist tutorial-third-fade"},s.a.createElement("li",{className:"first"},s.a.createElement("p",null,"Node 1 is a node in our database."),s.a.createElement("div",{className:"showcase",style:{textAlign:"center"}},s.a.createElement("div",{id:"s0n1",className:"dot-showcase",style:{float:"none"}},"1"))),s.a.createElement("li",null,s.a.createElement("p",null,"Let's send two write requests to the node, one after the other: w1 and w2."),s.a.createElement("div",{className:"showcase"},p({id:"s1w2",label:"w2",bgc:"rgba(24, 205, 250, 0.904)",animation:"s1 10s linear 8s infinite"}),p({id:"s1w1",label:"w1",bgc:"rgba(250, 235, 24, 0.904)",animation:"s1 10s linear 8s infinite"}),s.a.createElement("div",{id:"s1n1",className:"dot-showcase"},"1"))),s.a.createElement("li",null,s.a.createElement("p",null,"w2 travels faster and completes first."),s.a.createElement("div",{className:"showcase"},p({id:"s2w2",label:"w2",bgc:"rgba(24, 205, 250, 0.904)",animation:"s2w2 10s linear 14s infinite"}),p({id:"s2w1",label:"w1",bgc:"rgba(250, 235, 24, 0.904)",animation:"s2w1 10s linear 14s infinite"}),s.a.createElement("div",{id:"s2n1",className:"dot-showcase"},"1"))),s.a.createElement("li",null,s.a.createElement("p",null,"What happens when w1 arrives at the node after w2 already completed?"),s.a.createElement("p",null,"The database will write w1, and end up with w1's value."),s.a.createElement("div",{className:"showcase showcase-3"},p({id:"s3w1",label:"w1",bgc:"rgba(250, 235, 24, 0.904)",animation:"s3w1 10s linear 18s infinite",classes:"msg-showcase-3 s3n1"}),p({id:"s3w2",label:"w2",bgc:"rgba(24, 205, 250, 0.904)",animation:"s3w2 10s linear 18s infinite",classes:"msg-showcase-3 s3n1"}),s.a.createElement("div",{id:"s3n3",className:"dot-showcase",style:{backgroundColor:"rgba(250, 24, 24, 0.904)",color:"#fff"}},"w1"),s.a.createElement("div",{id:"s3n2",className:"dot-showcase s3n2",style:{backgroundColor:"rgba(24, 205, 250, 0.904)",animation:"s3n2 10s linear 18s infinite"}},"w2"),s.a.createElement("div",{id:"s3n1",className:"dot-showcase s3n1",style:{animation:"s3n1 10s linear 18s infinite"}},"1")),s.a.createElement("p",{style:{marginTop:"15px"}},"Seems backwards right? w2 was sent most recently so the database should end up with w2's value.")),s.a.createElement("li",null,s.a.createElement("p",null,"To solve this problem, each request is sent with a ",s.a.createElement("strong",null,"clock"),". It's just a number that counts up for each request sent and received."),s.a.createElement("p",null,"The clocks tell us that we sent w1 at time 5. We sent w2 right after, at time 6."),s.a.createElement("div",{className:"showcase",style:{textAlign:"center"}},s.a.createElement("div",{className:"half"},p({id:"s4w1",label:"w1",bgc:"rgba(250, 235, 24, 0.904)",animation:"",classes:"margin-auto display-block"}),s.a.createElement("div",{className:"tut-clock-label"},s.a.createElement("span",{style:{color:"#f1ef43",marginLeft:"10px"}},"clock: "),s.a.createElement("br",null),s.a.createElement("span",{style:{color:"#18cdfa"}},"["),s.a.createElement("span",{style:{color:"#f1f5fd"}}," 5 "),s.a.createElement("span",{style:{color:"#18cdfa",marginRight:"10px"}},"]"))),s.a.createElement("div",{className:"half float-right"},p({id:"s4w2",label:"w2",bgc:"rgba(24, 205, 250, 0.904)",animation:"",classes:"margin-auto display-block"}),s.a.createElement("div",{className:"tut-clock-label"},s.a.createElement("span",{style:{color:"#f1ef43",marginLeft:"10px"}},"clock: "),s.a.createElement("br",null),s.a.createElement("span",{style:{color:"#18cdfa"}},"["),s.a.createElement("span",{style:{color:"#f1f5fd"}}," 6 "),s.a.createElement("span",{style:{color:"#18cdfa",marginRight:"10px"}},"]"))))),s.a.createElement("li",null,s.a.createElement("p",null,"The node receives w2 first, and it remembers that w2 was sent at time 6."),s.a.createElement("div",{className:"showcase",style:{textAlign:"center"}},s.a.createElement("div",{className:"dot-showcase",style:{float:"none",margin:"auto",display:"block"}},"w2"),s.a.createElement("div",{className:"tut-clock-label"},s.a.createElement("span",{style:{color:"#f1ef43",marginLeft:"10px"}},"clock: "),s.a.createElement("br",null),s.a.createElement("span",{style:{color:"#18cdfa"}},"["),s.a.createElement("span",{style:{color:"#f1f5fd"}}," 6 "),s.a.createElement("span",{style:{color:"#18cdfa",marginRight:"10px"}},"]")))),s.a.createElement("li",null,s.a.createElement("p",null,"The node then receives w1. w1's clock is \"behind\" w2's clock so the node doesn't execute w1."),s.a.createElement("div",{className:"showcase",style:{textAlign:"center"}},s.a.createElement("div",{className:"half"},p({id:"s4w1",label:"w1",bgc:"rgba(250, 235, 24, 0.904)",animation:"",classes:"margin-auto display-block"}),s.a.createElement("div",{className:"tut-clock-label"},s.a.createElement("span",{style:{color:"#f1ef43",marginLeft:"10px"}},"clock: "),s.a.createElement("br",null),s.a.createElement("span",{style:{color:"#18cdfa"}},"["),s.a.createElement("span",{style:{color:"#f1f5fd"}}," 5 "),s.a.createElement("span",{style:{color:"#18cdfa",marginRight:"10px"}},"]"))),s.a.createElement("div",{className:"half float-right"},s.a.createElement("div",{className:"dot-showcase",style:{float:"none",margin:"auto",display:"block"}},"w2"),s.a.createElement("div",{className:"tut-clock-label"},s.a.createElement("span",{style:{color:"#f1ef43",marginLeft:"10px"}},"clock: "),s.a.createElement("br",null),s.a.createElement("span",{style:{color:"#18cdfa"}},"["),s.a.createElement("span",{style:{color:"#f1f5fd"}}," 6 "),s.a.createElement("span",{style:{color:"#18cdfa",marginRight:"10px"}},"]")))),s.a.createElement("p",{style:{marginTop:"15px"}},"When w1 arrives, it has already been overwritten by the more recent operation w2."),s.a.createElement("p",null,s.a.createElement("strong",null,"This is how logical clocks are used in distributed systems."))),s.a.createElement("li",{className:"last"},s.a.createElement("p",null,"To see logical clocks in action, enter these commands into the console on the main page: "),s.a.createElement("div",{className:"tut-clock-label",style:{paddingLeft:"10px",paddingRight:"10px",textAlign:"left"}},s.a.createElement("span",{style:{color:"#f1f5fd",display:"block",marginBottom:"5px"}},'node 0 update item 15 {"fruit": "apple"} delay 5'),s.a.createElement("span",{style:{color:"#f1f5fd",display:"block"}},'node 0 update item 15 {"fruit": "kiwi", "secondEdit":"true"}')),s.a.createElement("p",{style:{marginTop:"15px"}},"To learn what else you can do with this database simulation,",s.a.createElement("span",{className:"open-examples",onClick:function(){document.getElementById("root").style.removeProperty("height"),document.getElementById("app").style.removeProperty("height"),m("example-contents");try{document.getElementById("menu-close").scrollIntoView({behavior:"smooth"})}catch(e){document.getElementById("menu-close").scrollIntoView()}setTimeout((function(){document.getElementById("root").style.height=document.getElementById("menu").offsetHeight+"px",document.getElementById("app").style.height=document.getElementById("menu").offsetHeight+"px"}),500)}},window.innerWidth>1195?" click here.":" tap here.")))))),h=s.a.createElement(s.a.Fragment,null,f,s.a.createElement("div",{id:"example-wrapper",className:"menu-content-wrapper"},s.a.createElement("h1",{id:"example-contents-hero",className:"contents-hero"},"Example Commands"),s.a.createElement("ul",{id:"example-list",className:"instrlist menulist extra-p-margin"},s.a.createElement("li",{className:"first"},s.a.createElement("p",null,"All commands can be abbreviated."),s.a.createElement("p",null,"Read"),s.a.createElement("div",{className:"showcase",style:{textAlign:"center"}},s.a.createElement("div",{className:"half"},s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("span",null,"node 0 read item 15"))),s.a.createElement("div",{className:"half"},s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("span",null,"n 0 r 15"))))),s.a.createElement("li",null,s.a.createElement("p",null,"Insert"),s.a.createElement("div",{className:"showcase",style:{textAlign:"center"}},s.a.createElement("div",{className:"half"},s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("span",null,'node 0 insert item {"anyField":"anyString", "anyNumber":10 }'))),s.a.createElement("div",{className:"half"},s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("span",null,'n 0 i {"anyField":"anyString", "anyNumber":10 }'))))),s.a.createElement("li",null,s.a.createElement("p",null,"Update"),s.a.createElement("div",{className:"showcase",style:{textAlign:"center"}},s.a.createElement("div",{className:"half"},s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("span",null,'node 0 update item 15 {"anyField":"anyString", "anyNumber":10 }'))),s.a.createElement("div",{className:"half"},s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("span",null,'n 0 u 15 {"anyField":"anyString", "anyNumber":10 }'))))),s.a.createElement("li",null,s.a.createElement("p",null,"Delete"),s.a.createElement("div",{className:"showcase",style:{textAlign:"center"}},s.a.createElement("div",{className:"half"},s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("span",null,"node 0 delete item 15"))),s.a.createElement("div",{className:"half"},s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("span",null,"n 0 d 15"))))),s.a.createElement("li",null,s.a.createElement("p",null,"Execute multiple commands by entering them on different lines in the console."),s.a.createElement("p",null,s.a.createElement("strong",null,"Normal"),", the default, sends at the same time."),s.a.createElement("p",null,s.a.createElement("strong",null,"In-order")," guarantees that the first command finishes before the second."),s.a.createElement("p",null,s.a.createElement("strong",null,"Delay")," delays the command by a number of seconds."),s.a.createElement("div",{className:"showcase",style:{textAlign:"center"}},s.a.createElement("div",{className:"half"},s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("span",null,'node 0 update item 15 {"secondEdit":false} delay 5'))),s.a.createElement("div",{className:"half"},s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("span",null,'node 0 update item 15 {"secondEdit":true}')))),s.a.createElement("div",{className:"showcase",style:{textAlign:"center"}},s.a.createElement("div",{className:"half"},s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("div",null,"in-order"),s.a.createElement("div",null,"node 0 read item 15 delay 5"),s.a.createElement("div",null,"node 0 read item 15"))),s.a.createElement("div",{className:"half"},s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("div",null,"normal"),s.a.createElement("div",null,"node 0 read item 15"),s.a.createElement("div",null,'node 0 update item 15 {"secondEdit":true}'))))),s.a.createElement("li",null,s.a.createElement("h3",{style:{margin:"0"}},"Workflow"),s.a.createElement("p",null,window.innerWidth>1195?"Click ":"Tap ","each node to display its data."),s.a.createElement("p",null,"Note the nodeId that will send the request, and the itemId that will be read or modified."),s.a.createElement("div",{className:"showcase",style:{textAlign:"center"}},s.a.createElement("div",{className:"half ex-half"},s.a.createElement("div",{className:"dot-showcase",style:{float:"none",margin:"auto",display:"block"}},"0"),s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("span",{style:{color:"#f1ef43"}},"node 0 info"))),s.a.createElement("div",{className:"half ex-half"},s.a.createElement("div",{className:"dot-showcase",style:{float:"none",margin:"auto",display:"block",backgroundColor:"rgba(24, 205, 250, 0.904)"}},"5"),s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("span",{style:{color:"#f1ef43"}},"dataSlice: "),s.a.createElement("span",{style:{color:"#18cdfa"}},"["),s.a.createElement("span",{style:{color:"#f0d976"}},"{"),"itemId: 15, ...",s.a.createElement("span",{style:{color:"#f0d976"}},"}"),s.a.createElement("span",{style:{color:"#18cdfa"}},"]"))))),s.a.createElement("li",null,s.a.createElement("p",null,"Type your command in the console."),s.a.createElement("p",null,"Try ",window.innerWidth>1195?" clicking ":" tapping ","the node that will send the command. Notice how its clock changes during the command."),s.a.createElement("div",{className:"showcase",style:{textAlign:"center"}},s.a.createElement("div",{className:"half ex-half"},s.a.createElement("div",{className:"dot-showcase",style:{float:"none",margin:"auto",display:"block"}},"0"),s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("span",{style:{color:"#f1ef43",marginLeft:"10px"}},"clock: "),s.a.createElement("br",null),s.a.createElement("span",{style:{color:"#18cdfa"}},"["),s.a.createElement("span",{style:{color:"#f1f5fd"}}," 5 "),s.a.createElement("span",{style:{color:"#18cdfa",marginRight:"10px"}},"]"))),s.a.createElement("div",{className:"half ex-half"},s.a.createElement("div",{className:"dot-showcase",style:{float:"none",margin:"auto",display:"block"}},"0"),s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("span",{style:{color:"#f1ef43",marginLeft:"10px"}},"clock: "),s.a.createElement("br",null),s.a.createElement("span",{style:{color:"#18cdfa"}},"["),s.a.createElement("span",{style:{color:"#f1f5fd"}}," 6 "),s.a.createElement("span",{style:{color:"#18cdfa",marginRight:"10px"}},"]"))))),s.a.createElement("li",{className:"last"},s.a.createElement("p",null,"Hit the run button, and ",window.innerWidth>1195?" click ":" tap ","the blue message that pops up to see its contents. Then hit the play button."),s.a.createElement("p",null,"Pause the sim before and after the message hits the target node that contains data to be read or modified. How does the the target node's clock change?"),s.a.createElement("div",{className:"showcase",style:{textAlign:"center"}},s.a.createElement("div",{className:"half ex-half"},s.a.createElement("div",{className:"dot-showcase",style:{float:"none",margin:"auto",display:"block",backgroundColor:"rgba(24, 205, 250, 0.904)"}},"5"),s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("span",{style:{color:"#f1ef43",marginLeft:"10px"}},"clock: "),s.a.createElement("br",null),s.a.createElement("span",{style:{color:"#18cdfa"}},"["),s.a.createElement("span",{style:{color:"#f1f5fd"}}," 0 "),s.a.createElement("span",{style:{color:"#18cdfa",marginRight:"10px"}},"]"))),s.a.createElement("div",{className:"half ex-half"},s.a.createElement("div",{className:"dot-showcase",style:{float:"none",margin:"auto",display:"block",backgroundColor:"rgba(24, 205, 250, 0.904)"}},"5"),s.a.createElement("div",{className:"ex-clock-label"},s.a.createElement("span",{style:{color:"#f1ef43",marginLeft:"10px"}},"clock: "),s.a.createElement("br",null),s.a.createElement("span",{style:{color:"#18cdfa"}},"["),s.a.createElement("span",{style:{color:"#f1f5fd"}}," 2 "),s.a.createElement("span",{style:{color:"#18cdfa",marginRight:"10px"}},"]")))))))),y=s.a.createElement(s.a.Fragment,null,f,s.a.createElement("div",{id:"about-wrapper",className:"menu-content-wrapper"},s.a.createElement("h1",{id:"about-contents-hero",className:"contents-hero"},"Motivation"),s.a.createElement("ul",{id:"about-list",className:"instrlist menulist extra-p-margin"},s.a.createElement("li",{className:"first",style:{paddingTop:"0"}},s.a.createElement("h3",{style:{margin:"0"}},"Hello, I'm Aleexsan Adal."),s.a.createElement("p",null,"I heard about Lamport clocks from this episode of ",s.a.createElement("span",null,s.a.createElement("a",{target:"_blank",href:"https://softwareengineeringdaily.com/2019/09/18/distributed-databases-with-aly-cabral/"},"Software Engineering Daily,"))," and did some googling on the concept."),s.a.createElement("p",null,"Most articles explained what the algorithm is (just increment for messages sent and received), but none had a clear explanation of ",s.a.createElement("strong",null,"why a distributed system needs to track logical time."))),s.a.createElement("li",null,s.a.createElement("p",null,s.a.createElement("strong",null,"The system needs clocks to re-order operations that arrive out of order. "),"You could send write 1 and then write 2, but they may arrive in the reverse order due to network delay."),s.a.createElement("p",null,"The clocks will show which op was sent first, so the database nodes must compare the arriving clock with the most recent write's clock to determine what to do."),s.a.createElement("p",null,"This is the example explained in the welcome section.")),s.a.createElement("li",null,s.a.createElement("p",null,"I'm still bewildered that this example or similar ones aren't included in every explanation of logical clocks.")),s.a.createElement("li",{className:"last"},s.a.createElement("p",null,"--- From a visual learner, supporting other visual learners. Those engineering textbooks sure aren't.")))));Object(a.useEffect)((function(){"menu menu-full"===i[0]?(document.getElementById("root").style.height=document.getElementById("menu").offsetHeight+"px",document.getElementById("app").style.height=document.getElementById("menu").offsetHeight+"px"):"menu"===i[0]&&("initial-contents"!==d&&m("initial-contents"),document.getElementById("root").style.removeProperty("height"),document.getElementById("app").style.removeProperty("height"))}),[i]),Object(a.useEffect)((function(){if("tutorial-contents"===d){var e=document.getElementById("s1w1").offsetWidth,t=document.getElementById("s1n1").getBoundingClientRect().left-document.getElementById("s1w1").getBoundingClientRect().left-e,n=document.getElementById("s1n1").getBoundingClientRect().left-document.getElementById("s1w2").getBoundingClientRect().left-e;document.styleSheets[0].insertRule("@keyframes s1 {\n                    25% { transform: translate(".concat(t,"px, 0); }\n                    100% { transform: translate(").concat(t,"px, 0); }\n                }")),document.styleSheets[0].insertRule("@keyframes s2w1 {\n                    25% { transform: translate(".concat(t-e,"px, 0); }\n                    100% { transform: translate(").concat(t-e,"px, 0); }\n                }")),document.styleSheets[0].insertRule("@keyframes s2w2 {\n                    17% { transform: translate(".concat(n,"px, 0); }\n                    100% { transform: translate(").concat(n,"px, 0); }\n                }")),document.styleSheets[0].insertRule("@keyframes s3w2 {\n                    30%  { transform: translate(".concat(2*e,"px, 0); opacity: 1; }\n                    40%  { transform: translate(").concat(3*e,"px, 0); opacity: 0; }\n                    100% { transform: translate(").concat(3*e,"px, 0); opacity: 0; }\n                }")),document.styleSheets[0].insertRule("@keyframes s3n1 {\n                    30%  { opacity: 1; }\n                    40%  { opacity: 0; }\n                    100% { opacity: 0; }\n                }"),document.styleSheets[0].insertRule("@keyframes s3w1 {\n                    50%  { transform: translate(".concat(2*e,"px, 0); opacity: 1; }\n                    60%  { opacity: 1; }\n                    70%  { transform: translate(").concat(4*e,"px, 0); opacity: 0; }\n                    100% { transform: translate(").concat(4*e,"px, 0); opacity: 0; }\n                }")),document.styleSheets[0].insertRule("@keyframes s3n2 {\n                    60%  { opacity: 1; }\n                    70%  { opacity: 0; }\n                    100% { opacity: 0; }\n                }")}}),[d]);var v;return s.a.createElement(s.a.Fragment,null,s.a.createElement("header",null,s.a.createElement("nav",{id:"nav"},s.a.createElement("div",{className:"nav-title"},"dist-sim"),s.a.createElement("img",{id:"menu-btn",className:"menu-btn",src:b.a,alt:"Menu icon",onClick:function(){document.getElementById("tutorial-wrapper")?r(["menu menu-full","overlay overlay-active"]):r(["menu menu-active","overlay overlay-active"])}}))),s.a.createElement("div",{id:"overlay",className:i[1],onClick:function(){return r(["menu","overlay"])}}),s.a.createElement("div",{id:"menu",className:i[0]},s.a.createElement("svg",{onClick:function(){return r(["menu","overlay"])},id:"menu-close",className:"menu-close",viewBox:"0 0 20 20"},s.a.createElement("path",{d:"M10.185,1.417c-4.741,0-8.583,3.842-8.583,8.583c0,4.74,3.842,8.582,8.583,8.582S18.768,14.74,18.768,10C18.768,5.259,14.926,1.417,10.185,1.417 M10.185,17.68c-4.235,0-7.679-3.445-7.679-7.68c0-4.235,3.444-7.679,7.679-7.679S17.864,5.765,17.864,10C17.864,14.234,14.42,17.68,10.185,17.68 M10.824,10l2.842-2.844c0.178-0.176,0.178-0.46,0-0.637c-0.177-0.178-0.461-0.178-0.637,0l-2.844,2.841L7.341,6.52c-0.176-0.178-0.46-0.178-0.637,0c-0.178,0.176-0.178,0.461,0,0.637L9.546,10l-2.841,2.844c-0.178,0.176-0.178,0.461,0,0.637c0.178,0.178,0.459,0.178,0.637,0l2.844-2.841l2.844,2.841c0.178,0.178,0.459,0.178,0.637,0c0.178-0.176,0.178-0.461,0-0.637L10.824,10z"})),"tutorial-contents"===(v=d)?g:"example-contents"===v?h:"about-contents"===v?y:u))},N=function(){var e=Object(a.useState)(["node-info"]),t=Object(l.a)(e,2),n=t[0],i=t[1],r=Object(a.useState)(["run"]),o=Object(l.a)(r,2),m=o[0],p=o[1],f=Object(a.useState)("init"),g=Object(l.a)(f,2),h=g[0],y=g[1],v=Object(a.useState)(void 0),E=Object(l.a)(v,2),w=E[0],b=E[1],N=Object(a.useState)(void 0),x=Object(l.a)(N,2),S=x[0],O=x[1],R=Object(a.useState)(void 0),B=Object(l.a)(R,2),C=B[0],L=B[1],M=Object(a.useState)(void 0),J=Object(l.a)(M,2),j=J[0],P=J[1],A=Object(a.useState)(new Map),T=Object(l.a)(A,1)[0],H=Object(a.useState)([]),W=Object(l.a)(H,2),D=W[0],F=W[1],_=Object(a.useState)(!1),q=Object(l.a)(_,2),V=q[0],z=q[1];Object(a.useEffect)((function(){window.innerWidth>1195&&(document.documentElement.style.setProperty("--sim-wrapper-vertical-padding","70px"),document.documentElement.style.setProperty("--sim-wrapper-horizontal-padding","70px"),z(!0))}),[]),Object(a.useEffect)((function(){if(w){document.documentElement.style.setProperty("--prompt-width",document.getElementById("prompt").offsetWidth+"px"),document.getElementById("textarea").style.height=document.getElementById("console").offsetHeight-30-document.getElementById("run").offsetHeight+"px",document.addEventListener("click",(function(e){"circle-wrapper"!==e.target.id&&"sim-wrapper"!==e.target.id||X()})),document.getElementById("textarea").addEventListener("click",(function(e){window.innerWidth<=767&&G(),document.removeEventListener("click",Y),document.addEventListener("click",Y)}));for(var e=0;e<w.numNodes;e++)T.set(e,c(w.getNode(e)))}}),[w]),Object(a.useEffect)((function(){if(C){for(var e=D.length?D[0]:0;C[e]&&C[e].done;)T.set(C[e].nodeId,C[e].nodeInfoString),e++;D[0]=e>0?e-1:0}}),[C]);var Y=function e(t){var n=document.getElementById("run").contains(t.target)&&document.getElementById("run").classList.length>1;document.getElementById("textarea").contains(t.target)||n||(K(),document.removeEventListener("click",e))},U=function(e){document.getElementById("node-info-wrapper").innerHTML=e,1===document.getElementById("node-info").classList.length&&(i(["node-info node-info-active"]),setTimeout((function(){return document.getElementById("liveinfo").style.display="none"}),300))},X=function(){i(["node-info"]),document.getElementById("liveinfo").style.removeProperty("display"),setTimeout((function(){return document.getElementById("node-info").style.removeProperty("height")}),300)},K=function(){try{document.getElementById("nav").scrollIntoView({behavior:"smooth"})}catch(e){document.getElementById("nav").scrollIntoView()}},G=function(){try{document.getElementById("end").scrollIntoView({behavior:"smooth"})}catch(e){document.getElementById("end").scrollIntoView()}};return s.a.createElement("div",{id:"app",className:"app"},s.a.createElement(k,null),s.a.createElement(d,{net:w,getNodeInfo:function(e){return U(T.get(e))},getPayloadInfo:function(e,t){return U(function(e,t){console.log(e);var n=document.getElementById(t).innerHTML,a="";if("out"===e.dir)for(var s=0;s<e.path.length;s++)a=a.concat(e.path[s].toString()),s+1<e.path.length&&(a=a.concat(" => "));else for(var i=e.path.length-1;i>=0;i--)a=a.concat(e.path[i].toString()),i-1>=0&&(a=a.concat(" => "));var r="";"r"===e.op?r="read":"u"===e.op?r="update":"i"===e.op?r="insert":"d"===e.op&&(r="delete");var l="";e.itemId&&(l="<span style='color: #f1ef43'>itemId: </span>"+e.itemId+"</br>");var o="";e.item&&(o="<span style='color: #f1ef43'>item: </span>"+JSON.stringify(e.item,null,1)+"</br>");var c="";return e.msg&&(c="<span style='color: #f1ef43'>msg: </span>"+e.msg+"</br>"),"<h3 class='payloadinfo-h3'>payload "+n+" info</h3><span style='color: #f1ef43'>path: </span>"+a+"</br><span style='color: #f1ef43'>operation: </span>"+r+"</br>"+l+o+c+("<span style='color: #f1ef43'>sourceClock (node "+a[0]+"): </span>"+JSON.stringify(e.sourceClock)+"</br>")}(C[e].payload,t))},apiResponse:C,setApiResponse:L,sentInstructions:S,setSentInstructions:O,setFinishedExecuting:P,network:w,mostRecentNodeInfo:T,rerenderSim:V}),s.a.createElement(u,{ControlsProps:{setInstructionsToSend:O,finishedExecuting:j,setFinishedExecuting:P,setRunButtonClasses:p,runState:h,setRunState:y,setMostRecentStepCompleted:F},handleTextAreaInput:function(e){var t=document.getElementById("textarea").value;1===document.getElementById("tutorial").classList.length&&document.getElementById("tutorial").classList.add("display-none"),"run run-active"!==m[0]&&t?(p(["run run-active"]),document.getElementById("run").classList.add("run-active")):t||(p(["run"]),document.getElementById("run").classList.remove("run-active"))},apiResponse:C,sentInstructions:S}),s.a.createElement("div",{id:"node-info",className:n[0]},s.a.createElement("svg",{onClick:function(){return X()},id:"node-info-close",className:"node-info-close",viewBox:"0 0 20 20",style:{left:(window.innerWidth>766?window.innerWidth/2-45:window.innerWidth-45)+"px"}},s.a.createElement("path",{fill:"#f1f5fd",d:"M10.185,1.417c-4.741,0-8.583,3.842-8.583,8.583c0,4.74,3.842,8.582,8.583,8.582S18.768,14.74,18.768,10C18.768,5.259,14.926,1.417,10.185,1.417 M10.185,17.68c-4.235,0-7.679-3.445-7.679-7.68c0-4.235,3.444-7.679,7.679-7.679S17.864,5.765,17.864,10C17.864,14.234,14.42,17.68,10.185,17.68 M10.824,10l2.842-2.844c0.178-0.176,0.178-0.46,0-0.637c-0.177-0.178-0.461-0.178-0.637,0l-2.844,2.841L7.341,6.52c-0.176-0.178-0.46-0.178-0.637,0c-0.178,0.176-0.178,0.461,0,0.637L9.546,10l-2.841,2.844c-0.178,0.176-0.178,0.461,0,0.637c0.178,0.178,0.459,0.178,0.637,0l2.844-2.841l2.844,2.841c0.178,0.178,0.459,0.178,0.637,0c0.178-0.176,0.178-0.461,0-0.637L10.824,10z"})),s.a.createElement("div",{id:"node-info-wrapper"})),s.a.createElement(I,{network:w,setNetwork:b,sentInstructions:S,setApiResponse:L,simFinishedExecuting:j}))};r.a.render(s.a.createElement(N,null),document.getElementById("root"))}],[[8,1,2]]]);
//# sourceMappingURL=main.29075f9e.chunk.js.map